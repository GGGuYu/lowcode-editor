# React实现低代码编辑器
---
### React + TypeScript + Vite + zustand + antd + TailWindCss
react-dnd拖拽组件 ， Allotment的pane实现窗口大小的拖拽

---

### react19和andv5冲突
`bash
npm install @ant-design/v5-patch-for-react-19 --save
`

`
import '@ant-design/v5-patch-for-react-19';
`

---

### hover高光
通过种一个data-component-id = id来标记所有的材料
对画布监听鼠标Over,从e的事件冒泡路径取最底层拥有种子的div出来
把ID保存在一个状态里，从而随时处理最新的hover的组件
getBoundingClientRect拿到top，left,width,height这些边界属性
用一个Mask组件，给它高光
使用createPortal挂载，避免了其他样式的影响，比如overhidden,不会发生裁剪，重渲染的部分也更少
z-index让高亮组件在上面
注意还要设置 pointer-event 为 none，不响应鼠标事件。
优化性能，
使用 createPortal 是为了：
主要原因应该是：我们需要把高亮效果的DOM元素插入到画布的特定位置（视觉上覆盖组件），但不想让这个元素受React组件层级关系的约束
附带好处：
✅ 不会影响数据流和整个逻辑结构
✅ 确保高亮效果不会被意外裁剪
✅ 更可靠的层级管理
✅ 更精确的位置计算（特别是处理滚动时）
✅ 更好的性能（减少不必要的重渲染）
- 物理位置需求

高亮必须覆盖在所有用户组件之上（需要挂载到画布容器）

但高亮组件在逻辑上属于工具栏/画布控制器（不应该影响用户组件树）

- 规避层级污染

用户组件可能有 z-index: 9999 这样的"暴力"设置

Portal 可以确保高亮永远在最顶层（直接挂载到画布根容器）

- 代码组织合理性

高亮的逻辑（计算位置、显示条件）应该属于控制层代码

高亮的渲染需要侵入到画布视图层

### click的时候展示编辑框和属性设置
click 选中的组件除了展示编辑框，还要在右侧属性区展示对应的组件属性
所以有两个部分，都要用到click到哪儿了，所以需要用一个全局store的来保存信息比较好
click事件还是在画布做比较好，不然每个组件都要写加一个事件监听，为了通用性，还是画布
监听点击以后还是事件冒泡找到种下的data-component-id,就可以锁定当前id和组件类型
然后计算编辑框大小，也是用createPortal造一个Mask用来当编辑框
属性设置就简单了，只需要从store里面获取信息就好了

- 修复一个bug,更新组件树也必须更新所有mask的参数，不然的话，此时componentId没变，不更新，就会出现视觉上的bug
- 一个没修复成功的bug，窗口resize的时候，无法及时更新mask的position

### 属性编辑和样式编辑
属性编辑是按照预设哪些可以编辑的设置器，也就是config中的setter来渲染给用户填写的表单
也就是用户可以通过setter设定的字段，来在json的props中改变这些字段
style的自定义编辑 注意防抖lodash做了防抖
做一下**防抖**，核心就是，只有在500ms之后没有改变，我才回调进行真正的数据操作
所以需要一个定时器容器，真正的回调都依靠这个定时器，如果500ms内发生了改变，那么就清除掉这个定时器
最后呢，发现还有个问题，选择器和自定义这个，你自定义的地方修改了选择器的属性，或者反过来，都没法及时同步
修一下，通过两个flag传值，只要对方的flag改变，那我就更新一下，这样两边css显示就可以同步了